# Validate your file here: https://bitbucket-pipelines.atlassian.io/validator

options:
  docker: true

pipelines:
  default:
    - step:
        name: Docker Publish - DEV
        image: atlassian/default-image:2
        caches:
          - docker
        script:
          - docker build . -t default-image
          - >
            echo "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] http://packages.cloud.google.com/apt cloud-sdk main"
            | tee -a /etc/apt/sources.list.d/google-cloud-sdk.list
          - >
            curl https://packages.cloud.google.com/apt/doc/apt-key.gpg
            | apt-key --keyring /usr/share/keyrings/cloud.google.gpg add -
          - apt -qq update && apt -qq --assume-yes --fix-missing install google-cloud-sdk
          - export PATH="$PATH:./scripts/"
          - ./scripts/publish -i "default-image" -t "latest" -k "$GCLOUD_DEV_KEYFILE" -p "arquiveidev"
